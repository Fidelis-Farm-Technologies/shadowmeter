sources:
  flow_logs:
    type: "file"
    include:
      - "/opt/shadowmeter/spool/flow/flow.*.json"

transforms:
  flow_logs_parser:
    inputs:
      - "flow_logs"
    type: "remap"
    source: |
      ., err = parse_json(.message)
      del(.flows.dpi)

sinks:
  flow_logger:
    type: "datadog_logs"
    inputs:
      - "flow_logs_parser"
    compression: "gzip"
    default_api_key: "$DATADOG_API_KEY"
    endpoint: "$DATADOG_ENDPOINT"

# ---------------------------------------
# FOR DEBUGGING
# ---------------------------------------
# sinks:
#  print:
#    type: "console"
#    inputs:
#      - "flow_logs_parser"
#    encoding:
#      codec: "json"
